\documentclass[12pt,a4paper]{article}

\title{RoboRacers: Can You Stay On The Track? UPDATED}
\author{James Bennett}

% packages
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{xcolor}

\definecolor{varblue}{HTML}{9CDCFE}
\definecolor{constblue}{HTML}{4FC1FF}
\definecolor{decgreen}{HTML}{4EC9B0}
\definecolor{funyellow}{HTML}{DCDCAA}
\definecolor{keypurple}{HTML}{C586C0}
\definecolor{textorange}{HTML}{CE9178}
\definecolor{commentgreen}{HTML}{6A9955}
\definecolor{numgreen}{HTML}{B5CEA8}
\definecolor{punctyellow}{HTML}{6A9955}
\definecolor{opwhite}{HTML}{D4D4D4}

\definecolor{background}{HTML}{1F1F1F} %vscode background
\definecolor{vbbackground}{HTML}{D6D6D6} %grey vb background

\usepackage{listings}
\lstset{
    language=python,
    basicstyle=\ttfamily\small\color{opwhite},
    backgroundcolor=\color{background},
    commentstyle=\color{commentgreen},
    keywordstyle=\color{keypurple},
    stringstyle=\color{textorange},
    showstringspaces=false,
    breaklines=true,
}

\lstdefinestyle{moving}{
    %vars
    morekeywords=[2]{robot,ev3,screen,line_sensor,speaker,left_motor,threshold},
    keywordstyle=[2]\color{varblue},
    %funs
    morekeywords=[3]{straight, turn, drive,print,reflection,say,run_time},
    keywordstyle=[3]\color{funyellow},
    %nums
    morekeywords=[4]{distance, angle, turn_rate, drive_speed},
    keywordstyle=[4]\color{numgreen},
    %names
    morekeywords=[5]{ColorSensor,Port, DriveBase},
    keywordstyle=[5]\color{decgreen},
    %consts
    morekeywords=[6]{S3, LINE_REF, BACKGROUND_REF, FORWARD_SPEED, TURN_GAIN},
    keywordstyle=[6]\color{constblue},
}

\usepackage[skip=12pt plus2pt, indent=0pt]{parskip}

\usepackage{enumitem}
\setlist[enumerate]{itemsep=6pt,parsep=0pt}

\usepackage{awesomebox}
\newcommand{\thinkbox}[1]{\awesomebox[pink]{\aweboxrulewidth}{\faBrain}{pink}{#1}}
\setlength{\aweboxvskip}{4pt}

\usepackage{soul}
\sethlcolor{vbbackground}
\newcommand{\vb}[1]{\hl{\texttt{#1}}} % use for verbatim
\newcommand{\code}[1]{\colorbox{background}{\lstinline[style=moving]{#1}}} % use for actual code

\renewcommand{\familydefault}{\sfdefault}


\begin{document}

\begin{titlepage}
    \begin{center}
        \vspace{2em}
        \Huge
        \textbf{RoboRacers:}
        \\
        \vspace{1em}
        \Large
        Will you reach the top of the leaderboard? UPDATED
        \\
        \vspace{3em}
    \end{center}
\normalsize    
Welcome to RoboRacers! Today you will use a LEGO MINDSTORMS EV3 robot to try and race down a racetrack! Let's get going...

\begin{figure}[h]
    \centering
    \includegraphics[width=0.9\textwidth]{assets/robot_overview.jpg}
\end{figure}

\vfill
Look out for these boxes:
\notebox{Information boxes give useful information about the robot.}
\tipbox{Hint boxes give tips to to help you complete the tasks.}
\thinkbox{Think boxes give you something to think about, maybe an extra challenge...}

\end{titlepage}


\section*{Getting Started}
\subsection*{The Robot}
The robot is already turned on for you. You should see a green light on the robot. If you do not see a green light, ask your session leader for help. Look at the diagram below to see what the buttons on the robot do.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{assets/ev3brick_labelled.png}
\end{figure}

The \vb{up}, \vb{down}, \vb{left}, and \vb{right} buttons are not used to control the robot. They are used to navigate the \vb{programs} which are stored on the robot. Use the middle button to "click" on whatever is highlighted in black on the robot's screen. We are going to write some programs to control the robot!

You will see the robot has two wheels, and a sensor at the front. There should be a small red light on the sensor - check and see if it's there. If you can't see the red light, ask your session leader for help. Our programs will use the robot's wheels and sensor to move around.
\vspace{3.5cm}
\notebox{The robot has a speaker which can say things, and a screen which displays information. It also has two motors which turn its wheels, and a sensor to see the world through measuring light reflectance.}

\newpage
\subsection*{Running a program}
Look at the small screen on the robot, it should look like picture 1 below. Use the buttons on the robot to first open the \vb{File Browser}, then open the \vb{RoboChallenge} folder, then find the \vb{starting}.py file. This file contains a program, so the next step is to run it!

Make sure the file \vb{starting.py} is highlighted in black, then use the \vb{middle button} on the robot (the enter button) to run it. Listen closely! The robot should speak to you...

\begin{figure}[h]
    \centering
    \includegraphics[width=0.9\textwidth]{assets/run_program_manual.png}
\end{figure}

What did the robot say? It should have said ``Hello World!". This is a simple program which we will use to get started. If the robot didn't speak or make any noise, ask your session leader for help.

\vspace{3.5cm}
\notebox{If you want the robot to stop running a program, press the \vb{back} button at the bottom left of the robot screen to stop the program.}

\newpage
\subsection*{Editing a program}
Programs don't write themselves. It's great that the robot said ``Hello World", but that's not your name! So next, we'll change the \vb{starting.py} program to greet you specifically. You will write your code on the laptop using Visual Studio Code. This IDE (integrated development environment) is used by many students and many professionals use to write code.

Look at the laptop in front of you. It should be logged in, with the file \vb{starting.py} open. If you don't think this is the case, then ask your session leader for help. Follow the steps below to change \vb{starting.py} to make the robot greet you.

\vspace{0.6cm}
\notebox{Any line starting with \code{\#} is a comment which the robot ignores. e.g. \code{# This is a comment}. Every other line tells the robot to do something.}

\vspace{0.6cm}
\begin{enumerate}
    % \item Turn the laptop on and open the application Visual Studio Code if not already.
    % \item From the \vb{File} menu, select \vb{Open Folder...}. Select \vb{RoboChallenge} folder on the \vb{Desktop}.
    % \item On the laptop, open the file \vb{starting.py} by clicking on it in the \vb{Explorer} left panel. This was the program we just ran on the robot.
    \item Look for the line in the program which makes the robot say ``Hello World!''.
    \item Change the program to say``Hello [your names]!" (for example, ``Hello Jeremy!''). 
\end{enumerate}

\vspace{0.6cm}
\tipbox{\raggedright You will need to change the line which says \code{ev3.speaker.say("Hello World!")}}

\vspace{0.6cm}
Great, you've written your first program! Now, we need to send the program to the robot so it can run it. Go to the next page.

\vspace{0.6cm}
\thinkbox{Challenge: Can you make the robot say something else? Try changing the text in the \code{ev3.speaker.say()} function.}

\newpage
\subsection*{Downloading a program to the robot}
Now we need to download your new, edited program to the robot, and run it. The first step is to make sure the robot is connected to the laptop. You should have a USB cable connecting the robot to the laptop. If you aren't sure where to plug the robot in, or if you don't have a cable, ask your session leader for help.

On your screen, you should see the \vb{EV3DEV DEVICE BROWSER} at the bottom of the left panel. You may have to expand it by clicking on the small arrow next to it. If you don't see this, ask your session leader for help.

\notebox{The next steps are very important! Make sure you follow them carefully. If you get stuck, ask your session leader for help.}

Look for the small circle which is either green, yellow, or red. If it is green, like in picture 1 below, the robot is connected and ready to receive code. If it is yellow like in picture 2, the robot is currently in the process of connecting. If it is red, like in picture 3, the robot is not connected. If you are not connected, right click the robot's name, and then click \vb{Reconnect}.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.32\textwidth]{assets/connecting_ev3.png}
    \includegraphics[width=0.32\textwidth]{assets/connecting_ev3.png}
    \includegraphics[width=0.32\textwidth]{assets/connecting_ev3.png}
\end{figure}

The circle must be green like in picture 1 before you can download your program to the robot. If you can't make it turn green, ask your session leader for help. If it is green, move on to the steps below.

\begin{enumerate}
    \item Hover the cursor to the right of where it says \vb{EV3DEV DEVICE BROWSER}.
    \begin{figure}[h]
        \centering
        \includegraphics[width=0.32\textwidth]{assets/connecting_ev3.png}
    \end{figure} 
    \item Click on the right hand button which looks like an arrow pointing downwards.
    \begin{figure}[h]
        \centering
        \includegraphics[width=0.32\textwidth]{assets/connecting_ev3.png}
    \end{figure}
    \newpage
    \item Watch in the bottom right hand side of the laptop screen whilst the files and programs are downloaded to the robot. You should see a message saying \vb{Download Complete} when it has finished.
    \begin{figure}[h]
        \centering
        \includegraphics[width=0.32\textwidth]{assets/connecting_ev3.png}
    \end{figure}
    \item Now, unplug the robot, and run the program again by following the steps in the \vb{Running a Program} section above. Listen carefully to make sure the robot says your name!
\end{enumerate}

\notebox{Now that you have unplugged the robot, the little circle will be red when you plug it back in. This is normal, it just means the robot is not connected to the laptop. You will have to reconnect the robot to the laptop by right clicking on the robot's name and selecting \vb{Reconnect}.}

\newpage
\section*{Getting the robot to move}
On the laptop, open the file \vb{moving.py} from the left panel. The goal of this section is to get the robot to move in a few different ways, using a couple of different functions. Your first tasks are below, as well as the functions you will need to complete them...

\begin{enumerate}
    \item Drive forwards 500 mm 
    \item Drive backwards 500 mm 
    \item Turn 180° clockwise
    \item Turn 90° anti-clockwise
    \item Drive in a square
\end{enumerate}

To drive the robot in a straight line, we use:
\begin{lstlisting}[style=moving]
robot.straight(distance)
\end{lstlisting}
We don't actually include the word 'distance'. Instead, you need to replace it with a number to represent the \code{distance} you want the robot to move. This \code{distance} is in mm.

We must replace the \emph{word} \code{distance} with a \emph{number}. Here, it is the distance in millimeters that we want to move. 

Look at the bottom of \vb{moving.py} for an example.

To turn the robot on the spot, we(°), use:
\begin{lstlisting}[style=moving]
robot.turn(angle)
\end{lstlisting}
Here, you replace \code{angle} with the number of degrees you want the robot to turn.

\vspace{0.3cm}
\tipbox{Hint: Values can be negative.\newline Bonus hint: You can list commands one after another.}

\vspace{0.6cm}
\section*{Trial run along the racetrack}
Using the commands \code{robot.straight(distance)} and \code{robot.turn(angle)}, see how far along the racetrack you can get in 5 minutes. If you get to the end, well done! Tell the session leader.

Here are the rules for the tournament!
\begin{enumerate}
    \item Robot must start with wheels behind the start line.
    \item Robot must not leave the road or crash into trees.
    \item Robot's wheels must cross the finish line for a valid track completion.
\end{enumerate}

\newpage
\section*{Using the Reflectance Sensor}
You may have noticed that it was difficult and time consuming to complete the race track using manual commands. Robots use sensors to help make their own decisions by seeing the world around them, rather than us having to tell them every little thing down to the mm.

\thinkbox{Imagine trying to walk in a square with your eyes closed. That would be difficult! It would be much easier if you could see. By using the sensor, we are allowing the robot to ``see".}

The robots you are using have \textbf{reflectance sensors}. You should see it sticking out of the front of the robot, shining a red light onto the table. If you can't see this, ask your session leader for help.

The sensor shines a light onto the floor underneath it, and measures how much is reflected back. If the floor is a light colour (for example, white) it will have a \textbf{high} reflectance value but if it's dark (for example black) the reflectance will be \textbf{low}.

Let's make sure the sensor is working.
% make all numbers sequential ?
\begin{enumerate}
    \item On the robot, find the file \vb{sensing.py}.
    \item Put the robot at the start line on the piece of paper on your desk, with the wheels on the line.
    \item Run the \vb{sensing.py} file on the robot. It should stop when it reaches the black finish line.
\end{enumerate}

% introduce exploring the sensor values and how it works
Your task now is to make the robot stop at the grey line in the middle of the paper. Let's measure the reflectance of the grey line.

\begin{enumerate}
    \item On the robot, run \vb{threshold\_measurer.py}. You will see lots of numbers on the robot's screen - these are the reflectance value from the sensor.
    \item Move the robot (with your hand) and see how the values change when the sensor is over different coloured surfaces.
    \item To stop the program, press the back button (top left button) on the robot.
\end{enumerate}

% lets see how we can use these values to stop at grey line, set challenge
\thinkbox{think about ittttt}
To make the robot stop at the grey line, we need to change some code.

% next page ? more steps
\begin{enumerate}
    \item On the laptop, open \vb{sensing.py}.
    \item somehow encourage them to figure out to put the grey value in the file
    \item Put the robot at the start line on the piece of paper on your desk, with the wheels on the line. Run the \vb{sensing.py} file on the robot. What happens? 
\end{enumerate}

\newpage
\begin{enumerate}
\item Open the script \vb{threshold-test.py}. You will see in the program we have added the sensor with the line  
\begin{lstlisting}[style=moving]
line_sensor = ColorSensor(Port.S3)
\end{lstlisting}
and that we measure the reflectance and show it on the robot's screen with
\begin{lstlisting}[style=moving]
ev3.screen.print(line_sensor.reflection())
\end{lstlisting}

\item Run the program and look at the reflectance values shown on the robot's screen. 
\item Move the robot (with your hand) so the sensor is directly above the line and make a note of the reflectance value. Repeat to get a reflectance of the background surface. 
\item Now open \vb{sensing.py} and input the values you measured for \code{LINE\_REF} and \code{BACKGROUND\_REF}. 
\item Line up your robot pointing towards your finish line. 
\item Get the robot to drive then stop at the line by downloading and running the program. 
\item Examine the code and see if you can explain to a demonstrator how it works. 
\end{enumerate}

\newpage
\section*{The Final Round}
Now our robot can see, it's time to get our robot to race the track by following the line!

\thinkbox{Challenge: Pause before you look at the program and see if you can work out an \emph{algorithm} for the robot to follow the line.}

% dont make them input any values into racing.py, hardcode them
% the experimentation here is about speed and turn gain
\begin{enumerate}
\item Open \vb{racing.py} and input the same values for \code{LINE\_REF} and \code{BACKGROUND\_REF}. 
\item Run the program and put your robot on the racetrack. 
\item Read the comments that explain how the program works. 
\item Adjust \code{FORWARD\_SPEED} and \code{TURN\_GAIN} so that the robot can complete the racetrack! 
\end{enumerate}

\notebox{The robot follows the edge of a line (not the line itself). The \code{threshold} value is calculated to be grey, the average of measured white and black. Suppose the black line is on the left and the white background on the right. When the sensor sees more white than the threshold, the robot neeeds to turn to the left to find the line and the opposite for when it sees too much black. This is why the robot can only follow one side of the line.}

% \section*{Finishing}
Congratulations for getting your robot to race around the racetrack! Was your robot able to stay on the track? We hope you have learnt one way that robots can see the world and that you consider a future in robotics!
\end{document}